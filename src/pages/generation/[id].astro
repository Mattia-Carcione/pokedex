---
import IndexSection from "../../components/layouts/IndexSection.astro";
import { LINKS_API, SITE_TITLE } from "../../const";
import Layout from "../../layouts/Layout.astro";
import { getPokemonData } from "../../utils/helpers/getDataJson";
import type {
  GenerationInfo,
  NameUrl,
  PokeApi,
} from "../../utils/interfaces/types";

export async function getStaticPaths() {
  const link = LINKS_API.find((x) => x.id == "generation");
  const dataApi: NameUrl[] = [
    {
      name: link!.label,
      url: link!.href,
    },
  ];
  const data = (await getPokemonData(dataApi, "generations.json")) as PokeApi[];
  const response = await Promise.all(
    data.map(async (gen) => {
      const generation: GenerationInfo[] = await getPokemonData(
        gen.results,
        "generationData.json",
      );
      return generation.map((x) => {

        const id = x.id.toString();
        return {
          params: { id },
          props: { id, data: x },
        };
      });
    }),
  );
  return response.flat();
}

const { id, data } = Astro.props;
const path = [`pokemonDataGen${id}.json`, `pokemonSpeciesDataGen${id}.json`];

const title = SITE_TITLE + " - Gen " + id;
---

<Layout title={title} heroTitle="PoKÃ©Dex" description="">
  <IndexSection species={data.pokemon_species} path={path} />
</Layout>
