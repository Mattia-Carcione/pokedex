---
import IndexSection from '../../components/layouts/IndexSection.astro';
import { SITE_TITLE } from '../../const';
import Layout from '../../layouts/Layout.astro';
import { Sort } from '../../utils/helper';
import type { CardPokemon, Generation } from '../../utils/interfaces/types';
import { fetchGenerations, fetchGenerationById, fetchAllByGeneration } from '../../utils/pokeApi.ts';

export async function getStaticPaths() {
  const gens = await fetchGenerations();
  return gens.map((g: Generation) => {
    const id = g.id
    return {
      params: { id },
      props: { id },
    };
  });
};

const { id } = Astro.props;
const pokemonData = await fetchGenerationById(id);
const pokemonSpecies = Sort(pokemonData.pokemon_species);
const pokemon: CardPokemon[] = await fetchAllByGeneration(pokemonSpecies);
const title = SITE_TITLE + " - Gen " + id;
---

<Layout title={title} description=''>
  <IndexSection pokemon={pokemon} />
</Layout>
